{% extends "admin/index.html" %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    .dashboard-container {
        display: grid;
        grid-template-columns: 200px 1fr 1fr; 
        gap: 20px;
        margin-bottom: 30px;
        align-items: stretch; 
    }

    .dash-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        border: 1px solid #eee;
    }


    @media (max-width: 1200px) {
        .dashboard-container {
            grid-template-columns: 1fr 1fr; 
        }
        .total-card {
            grid-column: span 2; 
        }
    }
    
    @media (max-width: 768px) {
        .dashboard-container {
            grid-template-columns: 1fr; 
        }
        .total-card {
            grid-column: span 1;
        }
    }
</style>

<div>
    <h1 style="margin-bottom: 20px;">üìä Dashboard Anal√≠tico</h1>
    
    <div class="dashboard-container">
        
      
        <div class="dash-card total-card" style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
            <h2 style="margin: 0; color: #79aec8; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px;">Reservas</h2>
            <p style="font-size: 4rem; font-weight: bold; margin: 10px 0; color: #2c3e50;">{{ total_reservas|default:"0" }}</p>
            <span style="color: #999; font-size: 0.8rem;">Registradas no sistema</span>
        </div>

        
        <div class="dash-card">
            <h3 style="text-align: center; margin-top: 0; color: #555; font-size: 1rem;">üèÜ Salas Mais Utilizadas</h3>
            <div style="height: 200px; position: relative;">
                <canvas id="chartSalas"></canvas>
            </div>
        </div>

        
        <div class="dash-card">
            <h3 style="text-align: center; margin-top: 0; color: #555; font-size: 1rem;">üìå Status das Reservas</h3>
            <div style="height: 200px; position: relative; display: flex; justify-content: center;">
                <canvas id="chartStatus"></canvas>
            </div>
        </div>

    </div>
</div>


{{ block.super }}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const rawSalasLabels = '{{ chart_salas_labels|safe|default:"[]" }}';
        const rawSalasData = '{{ chart_salas_data|safe|default:"[]" }}';
        const rawStatusLabels = '{{ chart_status_labels|safe|default:"[]" }}';
        const rawStatusData = '{{ chart_status_data|safe|default:"[]" }}';

        try {
            const salasLabels = JSON.parse(rawSalasLabels);
            const salasData = JSON.parse(rawSalasData);
            const statusLabels = JSON.parse(rawStatusLabels);
            const statusData = JSON.parse(rawStatusData);

            
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false, 
                plugins: {
                    legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } }
                }
            };

            
            if (salasLabels.length > 0) {
                new Chart(document.getElementById('chartSalas'), {
                    type: 'bar',
                    data: {
                        labels: salasLabels,
                        datasets: [{
                            label: 'Reservas',
                            data: salasData,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
                    }
                });
            } else {
                document.getElementById('chartSalas').parentElement.innerHTML = '<p style="text-align:center; color:#ccc; line-height: 200px;">Sem dados</p>';
            }

            
            if (statusLabels.length > 0) {
                new Chart(document.getElementById('chartStatus'), {
                    type: 'doughnut',
                    data: {
                        labels: statusLabels,
                        datasets: [{
                            data: statusData,
                            backgroundColor: ['#27ae60', '#f39c12', '#c0392b', '#95a5a6', '#2c3e50'],
                            borderWidth: 1
                        }]
                    },
                    options: commonOptions
                });
            } else {
                 document.getElementById('chartStatus').parentElement.innerHTML = '<p style="text-align:center; color:#ccc; line-height: 200px;">Sem dados</p>';
            }
        } catch (e) {
            console.error("Erro ao gerar gr√°ficos:", e);
        }
    });
</script>
{% endblock %}